<!DOCTYPE html>
<html>
<head>
    <title>Simple Auth Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .result { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üîß Simple Auth Test</h1>
    
    <button onclick="testRegister()">Test Register</button>
    <button onclick="testLogin()">Test Login</button>
    <button onclick="clearData()">Clear Data</button>
    
    <div id="result" class="result">Click a button to test...</div>

    <script>
        // Inline functions to avoid any external file issues
        async function registerUser(userData) {
            try {
                console.log('Starting registration...', userData);
                
                // Get existing users
                const users = JSON.parse(localStorage.getItem('users')) || [];
                console.log('Existing users:', users);
                
                // Check if email already exists
                if (users.find(user => user.email === userData.email)) {
                    return { success: false, error: 'Email already registered' };
                }
                
                // Create new user
                const newUser = {
                    id: Date.now(),
                    name: userData.name,
                    email: userData.email,
                    password: userData.password,
                    phone: userData.phone || '',
                    created_at: new Date().toISOString()
                };
                
                console.log('New user created:', newUser);
                
                // Add to users array
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                
                console.log('User saved to localStorage');
                
                return { success: true, user: { id: newUser.id, name: newUser.name, email: newUser.email } };
            } catch (error) {
                console.error('Registration failed:', error);
                return { success: false, error: 'Registration failed: ' + error.message };
            }
        }

        async function loginUser(credentials) {
            try {
                console.log('Starting login...', credentials);
                
                const users = JSON.parse(localStorage.getItem('users')) || [];
                console.log('Users in storage:', users);
                
                const user = users.find(u => u.email === credentials.email && u.password === credentials.password);
                console.log('Found user:', user);
                
                if (user) {
                    // Store current user
                    const userSession = { id: user.id, name: user.name, email: user.email };
                    localStorage.setItem('currentUser', JSON.stringify(userSession));
                    console.log('User session stored:', userSession);
                    return { success: true, user: userSession };
                } else {
                    return { success: false, error: 'Invalid email or password' };
                }
            } catch (error) {
                console.error('Login failed:', error);
                return { success: false, error: 'Login failed: ' + error.message };
            }
        }

        async function testRegister() {
            const result = document.getElementById('result');
            result.innerHTML = 'Testing registration...';
            
            try {
                const userData = {
                    name: 'Test User',
                    email: 'test@example.com',
                    password: 'password123',
                    phone: '1234567890'
                };
                
                const response = await registerUser(userData);
                console.log('Registration response:', response);
                
                if (response.success) {
                    result.className = 'result success';
                    result.innerHTML = `
                        <h3>‚úÖ Registration Successful!</h3>
                        <p>User: ${response.user.name}</p>
                        <p>Email: ${response.user.email}</p>
                        <p>ID: ${response.user.id}</p>
                    `;
                } else {
                    result.className = 'result error';
                    result.innerHTML = `
                        <h3>‚ùå Registration Failed</h3>
                        <p>Error: ${response.error}</p>
                    `;
                }
            } catch (error) {
                result.className = 'result error';
                result.innerHTML = `
                    <h3>‚ùå Registration Error</h3>
                    <p>Error: ${error.message}</p>
                `;
            }
        }

        async function testLogin() {
            const result = document.getElementById('result');
            result.innerHTML = 'Testing login...';
            
            try {
                const credentials = {
                    email: 'test@example.com',
                    password: 'password123'
                };
                
                const response = await loginUser(credentials);
                console.log('Login response:', response);
                
                if (response.success) {
                    result.className = 'result success';
                    result.innerHTML = `
                        <h3>‚úÖ Login Successful!</h3>
                        <p>Welcome: ${response.user.name}</p>
                        <p>Email: ${response.user.email}</p>
                        <p>ID: ${response.user.id}</p>
                    `;
                } else {
                    result.className = 'result error';
                    result.innerHTML = `
                        <h3>‚ùå Login Failed</h3>
                        <p>Error: ${response.error}</p>
                    `;
                }
            } catch (error) {
                result.className = 'result error';
                result.innerHTML = `
                    <h3>‚ùå Login Error</h3>
                    <p>Error: ${error.message}</p>
                `;
            }
        }

        function clearData() {
            localStorage.removeItem('users');
            localStorage.removeItem('currentUser');
            document.getElementById('result').innerHTML = 'üóëÔ∏è All data cleared!';
            document.getElementById('result').className = 'result';
        }
    </script>
</body>
</html>
